<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ইয়াছিন টেলিকম - ফিনান্সিয়াল ম্যানেজমেন্ট</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
        }
        
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #17a2b8;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        .date-display {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        /* Dashboard Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.8rem;
            color: white;
        }
        
        .cash .stat-icon { background: var(--success); }
        .due .stat-icon { background: var(--warning); }
        .total .stat-icon { background: var(--secondary); }
        .customers .stat-icon { background: var(--primary); }
        
        .stat-info h3 {
            font-size: 1rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-info .amount {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        /* Customer Search Section */
        .customer-search-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid var(--light);
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .search-btn {
            background: var(--info);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background: #138496;
            transform: translateY(-2px);
        }
        
        .customer-details-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border-left: 5px solid var(--info);
            display: none;
        }
        
        .customer-details-card.active {
            display: block;
            animation: slideDown 0.5s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .customer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .customer-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .customer-avatar {
            width: 70px;
            height: 70px;
            background: var(--info);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            font-weight: bold;
        }
        
        .customer-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .customer-stat {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .customer-stat h4 {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .customer-stat .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark);
        }
        
        .customer-stat .due-value {
            color: var(--danger);
        }
        
        .customer-stat .paid-value {
            color: var(--success);
        }
        
        /* Time Filter */
        .time-filter {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .filter-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            background: var(--light);
            color: var(--dark);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        .filter-btn:hover:not(.active) {
            background: #ddd;
        }
        
        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .chart-card h3 {
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-card h3 i {
            color: var(--secondary);
        }
        
        /* Form Section */
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .form-container h2 {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .form-group label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .form-control {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        /* Lebanon Phone Number Style - FIXED */
        .phone-input-wrapper {
            position: relative;
        }
        
        .phone-prefix {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-weight: bold;
            background: transparent;
            padding: 2px 8px;
            border-radius: 5px;
            z-index: 2;
            pointer-events: none;
        }
        
        .phone-input {
            padding-left: 45px !important;
            background-color: white;
            position: relative;
            z-index: 1;
        }
        
        .phone-input::-webkit-outer-spin-button,
        .phone-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* Firefox */
        .phone-input[type=number] {
            -moz-appearance: textfield;
        }
        
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .autocomplete-dropdown.active {
            display: block;
        }
        
        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .autocomplete-item:hover {
            background: #f5f5f5;
        }
        
        .autocomplete-item .phone {
            font-size: 0.8rem;
            color: #666;
            margin-left: 10px;
        }
        
        .btn-submit {
            background: linear-gradient(to right, var(--success), #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        /* Data Table */
        .data-table-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .data-table-container h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        .status-paid {
            background: #d4edda;
            color: #155724;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status-due {
            background: #fff3cd;
            color: #856404;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .edit-btn {
            background: var(--warning);
            color: white;
        }
        
        .delete-btn {
            background: var(--danger);
            color: white;
        }
        
        .action-btn:hover {
            opacity: 0.9;
        }
        
        /* Footer */
        footer {
            background: var(--primary);
            color: white;
            padding: 30px 20px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .footer-section h3 {
            color: var(--info);
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 2px solid var(--info);
            padding-bottom: 8px;
            display: inline-block;
        }
        
        .footer-section p {
            line-height: 1.6;
            color: #e0e0e0;
            font-size: 0.95rem;
        }
        
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .contact-item i {
            color: var(--info);
            width: 20px;
            text-align: center;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #bdbdbd;
            font-size: 0.9rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .time-filter {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .customer-stats {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.info {
            background: var(--info);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Auto-fill indicator */
        .auto-fill-indicator {
            position: absolute;
            right: 10px;
            top: 40px;
            background: var(--info);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            display: none;
        }
        
        .auto-fill-indicator.active {
            display: block;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        /* Validation Message */
        .validation-message {
            color: var(--danger);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }
        
        .validation-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <i class="fas fa-wifi"></i>
                <div>
                    <h1>টেলিকম ব্যবসা - ফিনান্সিয়াল ম্যানেজমেন্ট</h1>
                    <p>কাস্টমার বাকী ও নগদ লেনদেন ট্র্যাক করুন</p>
                </div>
            </div>
            <div class="date-display" id="currentDate">
                <!-- তারিখ জাভাস্ক্রিপ্ট দিয়ে দেখানো হবে -->
            </div>
        </header>
        
        <!-- Dashboard Stats -->
        <div class="stats-container">
            <div class="stat-card cash">
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-info">
                    <h3>আজকের নগদ</h3>
                    <div class="amount">৳ <span id="todayCash">0</span></div>
                    <p id="todayCashChange"></p>
                </div>
            </div>
            
            <div class="stat-card due">
                <div class="stat-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <div class="stat-info">
                    <h3>মোট বাকী</h3>
                    <div class="amount">৳ <span id="totalDue">0</span></div>
                    <p id="totalDueChange"></p>
                </div>
            </div>
            
            <div class="stat-card total">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-info">
                    <h3>মোট বিক্রি</h3>
                    <div class="amount">৳ <span id="totalSales">0</span></div>
                    <p id="totalSalesChange"></p>
                </div>
            </div>
            
            <div class="stat-card customers">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3>মোট কাস্টমার</h3>
                    <div class="amount"><span id="totalCustomers">0</span></div>
                    <p id="customerChange"></p>
                </div>
            </div>
        </div>
        
        <!-- Customer Search Section -->
        <div class="customer-search-container">
            <div class="search-header">
                <h2><i class="fas fa-search"></i> কাস্টমার খুঁজুন</h2>
                <div class="search-box">
                    <input type="text" 
                           id="customerSearch" 
                           class="search-input" 
                           placeholder="কাস্টমারের নাম বা মোবাইল নম্বর লিখুন...">
                    <button type="button" class="search-btn" onclick="searchCustomer()">
                        <i class="fas fa-search"></i> খুঁজুন
                    </button>
                </div>
            </div>
            
            <div id="customerDetails" class="customer-details-card">
                <div class="customer-header">
                    <div class="customer-info">
                        <div class="customer-avatar" id="customerAvatar">A</div>
                        <div>
                            <h3 id="customerNameDisplay">কাস্টমারের নাম</h3>
                            <p id="customerPhoneDisplay">মোবাইল: +961 XXXXXXXX</p>
                        </div>
                    </div>
                    <div>
                        <button type="button" class="search-btn" onclick="showAllTransactions()">
                            <i class="fas fa-list"></i> সকল লেনদেন দেখুন
                        </button>
                    </div>
                </div>
                
                <div class="customer-stats">
                    <div class="customer-stat">
                        <h4>মোট বাকী</h4>
                        <div class="value due-value" id="customerTotalDue">৳ ০</div>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">সর্বমোট বাকী টাকা</p>
                    </div>
                    
                    <div class="customer-stat">
                        <h4>মোট নগদ প্রদান</h4>
                        <div class="value paid-value" id="customerTotalPaid">৳ ০</div>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">সর্বমোট প্রদানকৃত</p>
                    </div>
                    
                    <div class="customer-stat">
                        <h4>মোট লেনদেন</h4>
                        <div class="value" id="customerTotalTransactions">০ বার</div>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">সর্বমোট লেনদেন সংখ্যা</p>
                    </div>
                    
                    <div class="customer-stat">
                        <h4>সর্বশেষ লেনদেন</h4>
                        <div class="value" id="customerLastTransaction">তারিখ নেই</div>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">সর্বশেষ লেনদেন তারিখ</p>
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <h4><i class="fas fa-history"></i> সাম্প্রতিক লেনদেন (শেষ ৫টি)</h4>
                    <div id="recentTransactions" style="margin-top: 15px;">
                        <!-- সাম্প্রতিক লেনদেন দেখানো হবে -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Time Filter -->
        <div class="time-filter">
            <div>
                <h3>ডেটা ফিল্টার করুন:</h3>
            </div>
            <div class="filter-options">
                <button type="button" class="filter-btn active" onclick="filterData('today')">আজ</button>
                <button type="button" class="filter-btn" onclick="filterData('week')">এই সপ্তাহ</button>
                <button type="button" class="filter-btn" onclick="filterData('month')">এই মাস</button>
                <button type="button" class="filter-btn" onclick="filterData('all')">সব ডেটা</button>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="charts-container">
            <div class="chart-card">
                <h3><i class="fas fa-chart-pie"></i> নগদ vs বাকী</h3>
                <canvas id="cashVsDueChart"></canvas>
            </div>
            
            <div class="chart-card">
                <h3><i class="fas fa-chart-bar"></i> সাপ্তাহিক বিক্রি</h3>
                <canvas id="weeklySalesChart"></canvas>
            </div>
        </div>
        
        <!-- Data Entry Form -->
        <div class="form-container">
            <h2><i class="fas fa-plus-circle"></i> নতুন লেনদেন যোগ করুন</h2>
            <form id="transactionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName"><i class="fas fa-user"></i> কাস্টমার নাম *</label>
                        <input type="text" id="customerName" class="form-control" placeholder="কাস্টমারের নাম লিখুন" required>
                        <div id="nameAutocomplete" class="autocomplete-dropdown"></div>
                        <div id="nameValidation" class="validation-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone"><i class="fas fa-phone"></i> মোবাইল নম্বর *</label>
                        <div class="phone-input-wrapper">
                            <span class="phone-prefix">+961</span>
                            <input type="text" id="phone" class="form-control phone-input" placeholder="70 769 781" required>
                        </div>
                        <small style="color: #666; font-size: 0.8rem; margin-top: 5px;">লেবানন ফরম্যাট: +961 XXXXXXXX (8-11 ডিজিট)</small>
                        <div id="phoneValidation" class="validation-message"></div>
                        <div id="phoneAutocomplete" class="autocomplete-dropdown"></div>
                        <span id="autoFillIndicator" class="auto-fill-indicator">নাম অটোফিল হচ্ছে</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="serviceType"><i class="fas fa-concierge-bell"></i> সেবার ধরন *</label>
                        <select id="serviceType" class="form-control" required>
                            <option value="">সেবা নির্বাচন করুন</option>
                            <option value="ইন্টারনেট">ইন্টারনেট</option>
                            <option value="মোবাইল রিচার্জ">মোবাইল রিচার্জ</option>
                            <option value="বিল পেমেন্ট">বিল পেমেন্ট</option>
                            <option value="সিম কার্ড">সিম কার্ড</option>
                            <option value="অন্যান্য">অন্যান্য</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="amount"><i class="fas fa-money-bill-wave"></i> মোট টাকা *</label>
                        <input type="number" id="amount" class="form-control" placeholder="মোট টাকার পরিমাণ" required min="0" step="0.01">
                        <div id="amountValidation" class="validation-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="paidAmount"><i class="fas fa-cash-register"></i> নগদ প্রদান</label>
                        <input type="number" id="paidAmount" class="form-control" placeholder="নগদ টাকার পরিমাণ (ঐচ্ছিক)" min="0" step="0.01" value="0">
                        <div id="paidValidation" class="validation-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="dueAmount"><i class="fas fa-clock"></i> বাকী টাকা</label>
                        <input type="number" id="dueAmount" class="form-control" placeholder="বাকী টাকা" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="transactionDate"><i class="fas fa-calendar-alt"></i> তারিখ *</label>
                        <input type="date" id="transactionDate" class="form-control" required>
                        <div id="dateValidation" class="validation-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes"><i class="fas fa-sticky-note"></i> নোট</label>
                        <input type="text" id="notes" class="form-control" placeholder="অতিরিক্ত তথ্য (যদি থাকে)">
                    </div>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> লেনদেন সেভ করুন
                </button>
            </form>
        </div>
        
        <!-- Data Table -->
        <div class="data-table-container">
            <h2><i class="fas fa-list"></i> সকল লেনদেনের তালিকা</h2>
            <table id="transactionsTable">
                <thead>
                    <tr>
                        <th>তারিখ</th>
                        <th>কাস্টমার নাম</th>
                        <th>সেবার ধরন</th>
                        <th>মোট টাকা</th>
                        <th>নগদ</th>
                        <th>বাকী</th>
                        <th>স্ট্যাটাস</th>
                        <th>মোবাইল</th>
                        <th>অ্যাকশন</th>
                    </tr>
                </thead>
                <tbody id="transactionsBody">
                    <!-- ডেটা জাভাস্ক্রিপ্ট দিয়ে দেখানো হবে -->
                </tbody>
            </table>
        </div>
        
        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h3>যোগাযোগ তথ্য</h3>
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-user"></i>
                            <span><strong>Name:</strong> Yeasin</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <span><strong>Mobile:</strong> +961 76 074 708</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span><strong>Location:</strong> Masjid Hamza (Al-Kola), Lebanon</span>
                        </div>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>ব্যবসা সম্পর্কে</h3>
                    <p>লেবানন ভিত্তিক টেলিকম ব্যবসা। মোবাইল রিচার্জ, ইন্টারনেট প্যাকেজ, বিল পেমেন্ট এবং অন্যান্য টেলিকম সেবা প্রদান করা হয়।</p>
                </div>
                
                <div class="footer-section">
                    <h3>সহায়তা</h3>
                    <p>যে কোন সমস্যা বা সাহায্যের জন্য সরাসরি মোবাইল নম্বরে যোগাযোগ করুন। ২৪ ঘন্টা কাস্টমার সেবা উপলব্ধ।</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>টেলিকম ব্যবসা ফিনান্সিয়াল ম্যানেজমেন্ট সিস্টেম &copy; <span id="currentYear"></span> | SPCK Editor-এ তৈরি</p>
            </div>
        </footer>
    </div>

    <script>
        // Global variables
        let currentCustomer = null;
        let allCustomers = [];
        let currentFilter = 'all';
        let phoneToNameMap = new Map();
        
        // বর্তমান তারিখ দেখানো
        document.addEventListener('DOMContentLoaded', function() {
            // তারিখ সেট করুন
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('bn-BD', options);
            document.getElementById('currentYear').textContent = now.getFullYear();
            
            // আজকের তারিখ ডিফল্ট হিসেবে সেট করুন
            document.getElementById('transactionDate').valueAsDate = now;
            
            // লোড করা ডেটা
            loadData();
            updateDashboard();
            renderCharts();
            
            // বাকী টাকা অটো ক্যালকুলেট
            document.getElementById('amount').addEventListener('input', calculateDue);
            document.getElementById('paidAmount').addEventListener('input', calculateDue);
            
            // ফর্ম সাবমিট
            document.getElementById('transactionForm').addEventListener('submit', handleFormSubmit);
            
            // Enter key press event for search
            document.getElementById('customerSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchCustomer();
                }
            });
            
            // Load all customers for autocomplete
            loadAllCustomers();
            
            // মোবাইল নম্বর ইনপুটে ইভেন্ট লিসেনার
            document.getElementById('phone').addEventListener('input', handlePhoneInput);
            document.getElementById('phone').addEventListener('blur', handlePhoneBlur);
            
            // কাস্টমার নাম ইনপুটে অটো-কমপ্লিট
            document.getElementById('customerName').addEventListener('input', handleNameInput);
            
            // ফোন নম্বর ফরম্যাটিং (8-11 ডিজিটের জন্য)
            document.getElementById('phone').addEventListener('input', formatLebanonPhone);
            
            // ডিবাগ: Check if form is working
            console.log("অ্যাপ্লিকেশন লোড সম্পন্ন!");
        });
        
        // লেবানন ফোন নম্বর ফরম্যাট (8-11 ডিজিট)
        function formatLebanonPhone() {
            const phoneInput = document.getElementById('phone');
            let value = phoneInput.value.replace(/\D/g, '');
            
            // শুধু সংখ্যা রাখুন এবং সর্বোচ্চ 11 ডিজিট
            if (value.length > 0) {
                value = value.substring(0, 11);
                
                // গ্রুপে ভাগ করুন: XX XXX XXXX (বা তার বেশি)
                if (value.length > 2) {
                    value = value.substring(0, 2) + ' ' + value.substring(2);
                }
                if (value.length > 6) {
                    value = value.substring(0, 6) + ' ' + value.substring(6);
                }
                if (value.length > 10) {
                    value = value.substring(0, 10) + ' ' + value.substring(10);
                }
            }
            
            phoneInput.value = value;
            
            // ভ্যালিডেশন মেসেজ আপডেট
            validatePhoneNumber();
        }
        
        // ফোন নম্বর ভ্যালিডেশন
        function validatePhoneNumber() {
            const phoneInput = document.getElementById('phone');
            const validationMsg = document.getElementById('phoneValidation');
            const phoneValue = phoneInput.value.replace(/\s/g, '').replace(/\D/g, '');
            
            if (phoneValue.length < 8) {
                validationMsg.textContent = 'ফোন নম্বর কমপক্ষে ৮ ডিজিট হতে হবে';
                validationMsg.classList.add('show');
                return false;
            } else if (phoneValue.length > 11) {
                validationMsg.textContent = 'ফোন নম্বর সর্বোচ্চ ১১ ডিজিট হতে পারে';
                validationMsg.classList.add('show');
                return false;
            } else {
                validationMsg.classList.remove('show');
                return true;
            }
        }
        
        // সব কাস্টমার লোড করুন এবং ফোন-টু-নাম ম্যাপ তৈরি করুন
        function loadAllCustomers() {
            try {
                const transactions = loadData();
                const customerMap = new Map();
                phoneToNameMap.clear();
                
                transactions.forEach(transaction => {
                    const key = `${transaction.customerName}|${transaction.phone || 'নাই'}`;
                    if (!customerMap.has(key)) {
                        customerMap.set(key, {
                            name: transaction.customerName,
                            phone: transaction.phone || 'নাই',
                            totalPaid: 0,
                            totalDue: 0,
                            transactions: []
                        });
                    }
                    
                    const customer = customerMap.get(key);
                    customer.totalPaid += parseFloat(transaction.paidAmount) || 0;
                    customer.totalDue += parseFloat(transaction.dueAmount) || 0;
                    customer.transactions.push(transaction);
                    
                    // ফোন নম্বার থেকে নাম ম্যাপিং করুন
                    if (transaction.phone && transaction.phone !== 'নাই') {
                        phoneToNameMap.set(transaction.phone, transaction.customerName);
                    }
                });
                
                allCustomers = Array.from(customerMap.values());
                console.log("কাস্টমার লোড সম্পন্ন:", allCustomers.length, "জন");
                console.log("ফোন-টু-নাম ম্যাপ:", phoneToNameMap);
            } catch (error) {
                console.error("কাস্টমার লোডে সমস্যা:", error);
                allCustomers = [];
            }
        }
        
        // মোবাইল ইনপুট হ্যান্ডলার
        function handlePhoneInput() {
            const phoneInput = document.getElementById('phone');
            const nameInput = document.getElementById('customerName');
            const phoneValue = phoneInput.value.trim();
            
            // শুধু নাম্বার নিশ্চিত করুন
            const numericPhone = phoneValue.replace(/\s/g, '').replace(/\D/g, '');
            
            // যদি মোবাইলের দৈর্ঘ্য ৮-১১ সংখ্যার কাছাকাছি হয় (লেবানন মোবাইল)
            if (numericPhone.length >= 8) {
                const fullPhone = '+961 ' + numericPhone;
                
                // ফোন ম্যাপ থেকে নাম খুঁজুন
                let foundName = null;
                
                // এক্সাক্ট ম্যাচ চেক করুন
                if (phoneToNameMap.has(fullPhone)) {
                    foundName = phoneToNameMap.get(fullPhone);
                } else {
                    // পার্শিয়াল ম্যাচ চেক করুন
                    for (const [phone, name] of phoneToNameMap) {
                        const cleanPhone = phone.replace(/\s/g, '').replace(/\D/g, '');
                        if (cleanPhone.includes(numericPhone) || numericPhone.includes(cleanPhone)) {
                            foundName = name;
                            break;
                        }
                    }
                }
                
                // যদি নাম পাওয়া যায়
                if (foundName && nameInput.value.trim() === '') {
                    nameInput.value = foundName;
                    showAutoFillIndicator();
                    showNotification(`কাস্টমার নাম অটোফিল হয়েছে: ${foundName}`, 'info');
                }
            }
            
            // ফোন অটো-কমপ্লিট
            showPhoneAutocomplete(phoneValue);
        }
        
        // মোবাইল ব্লার হ্যান্ডলার (ইনপুট থেকে ফোকাস সরালে)
        function handlePhoneBlur() {
            setTimeout(() => {
                const phoneAutocomplete = document.getElementById('phoneAutocomplete');
                phoneAutocomplete.classList.remove('active');
            }, 200);
        }
        
        // নাম ইনপুট হ্যান্ডলার
        function handleNameInput() {
            const nameInput = document.getElementById('customerName');
            const nameValue = nameInput.value.trim();
            
            if (nameValue.length >= 2) {
                showNameAutocomplete(nameValue);
            } else {
                const autocomplete = document.getElementById('nameAutocomplete');
                autocomplete.classList.remove('active');
            }
        }
        
        // নাম অটো-কমপ্লিট দেখান
        function showNameAutocomplete(searchTerm) {
            const autocomplete = document.getElementById('nameAutocomplete');
            autocomplete.innerHTML = '';
            
            const matches = allCustomers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm.toLowerCase())
            ).slice(0, 5);
            
            if (matches.length > 0) {
                matches.forEach(customer => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.innerHTML = `
                        ${customer.name}
                        <span class="phone">${customer.phone}</span>
                    `;
                    item.onclick = () => {
                        document.getElementById('customerName').value = customer.name;
                        // ফোন নম্বর শুধু নাম্বার অংশ সেট করুন
                        const phoneNumberOnly = customer.phone.replace('+961 ', '').replace(/\s/g, '');
                        document.getElementById('phone').value = phoneNumberOnly;
                        autocomplete.classList.remove('active');
                    };
                    autocomplete.appendChild(item);
                });
                autocomplete.classList.add('active');
            } else {
                autocomplete.classList.remove('active');
            }
        }
        
        // ফোন অটো-কমপ্লিট দেখান
        function showPhoneAutocomplete(searchTerm) {
            const autocomplete = document.getElementById('phoneAutocomplete');
            autocomplete.innerHTML = '';
            
            const numericSearch = searchTerm.replace(/\s/g, '').replace(/\D/g, '');
            
            if (numericSearch.length >= 3) {
                const matches = allCustomers.filter(customer => 
                    customer.phone !== 'নাই' && 
                    customer.phone.replace(/\s/g, '').replace(/\D/g, '').includes(numericSearch)
                ).slice(0, 5);
                
                if (matches.length > 0) {
                    matches.forEach(customer => {
                        const item = document.createElement('div');
                        item.className = 'autocomplete-item';
                        const phoneNumberOnly = customer.phone.replace('+961 ', '').replace(/\s/g, '');
                        item.innerHTML = `
                            ${customer.phone}
                            <span class="phone">${customer.name}</span>
                        `;
                        item.onclick = () => {
                            document.getElementById('phone').value = phoneNumberOnly;
                            document.getElementById('customerName').value = customer.name;
                            autocomplete.classList.remove('active');
                            showAutoFillIndicator();
                        };
                        autocomplete.appendChild(item);
                    });
                    autocomplete.classList.add('active');
                } else {
                    autocomplete.classList.remove('active');
                }
            } else {
                autocomplete.classList.remove('active');
            }
        }
        
        // অটো-ফিল ইন্ডিকেটর দেখান
        function showAutoFillIndicator() {
            const indicator = document.getElementById('autoFillIndicator');
            indicator.classList.add('active');
            
            setTimeout(() => {
                indicator.classList.remove('active');
            }, 3000);
        }
        
        // বাকী টাকা ক্যালকুলেট
        function calculateDue() {
            try {
                const amount = parseFloat(document.getElementById('amount').value) || 0;
                const paid = parseFloat(document.getElementById('paidAmount').value) || 0;
                const due = amount - paid;
                
                document.getElementById('dueAmount').value = due >= 0 ? due.toFixed(2) : 0;
            } catch (error) {
                console.error("বাকী টাকা ক্যালকুলেটে সমস্যা:", error);
            }
        }
        
        // ফর্ম সাবমিট হ্যান্ডলার - FIXED
        function handleFormSubmit(e) {
            e.preventDefault();
            console.log("ফর্ম সাবমিট করা হচ্ছে...");
            
            // প্রথমে সব ভ্যালিডেশন চেক করুন
            if (!validateForm()) {
                return;
            }
            
            addTransaction();
        }
        
        // ফর্ম ভ্যালিডেশন ফাংশন - NEW
        function validateForm() {
            let isValid = true;
            
            // কাস্টমার নাম ভ্যালিডেশন
            const customerName = document.getElementById('customerName').value.trim();
            const nameValidation = document.getElementById('nameValidation');
            if (!customerName) {
                nameValidation.textContent = 'কাস্টমারের নাম দিন';
                nameValidation.classList.add('show');
                isValid = false;
            } else {
                nameValidation.classList.remove('show');
            }
            
            // ফোন নম্বর ভ্যালিডেশন
            if (!validatePhoneNumber()) {
                isValid = false;
            }
            
            // সেবার ধরন ভ্যালিডেশন
            const serviceType = document.getElementById('serviceType').value;
            if (!serviceType) {
                showNotification('সেবার ধরন নির্বাচন করুন!', 'error');
                isValid = false;
            }
            
            // টাকা ভ্যালিডেশন
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const amountValidation = document.getElementById('amountValidation');
            if (!amount || amount <= 0) {
                amountValidation.textContent = 'সঠিক মোট টাকা দিন';
                amountValidation.classList.add('show');
                isValid = false;
            } else {
                amountValidation.classList.remove('show');
            }
            
            // নগদ ভ্যালিডেশন - OPTIONAL NOW
            const paidAmount = parseFloat(document.getElementById('paidAmount').value) || 0;
            const paidValidation = document.getElementById('paidValidation');
            if (paidAmount < 0) {
                paidValidation.textContent = 'নগদ টাকা নেগেটিভ হতে পারে না';
                paidValidation.classList.add('show');
                isValid = false;
            } else {
                paidValidation.classList.remove('show');
            }
            
            // তারিখ ভ্যালিডেশন
            const transactionDate = document.getElementById('transactionDate').value;
            const dateValidation = document.getElementById('dateValidation');
            if (!transactionDate) {
                dateValidation.textContent = 'তারিখ নির্বাচন করুন';
                dateValidation.classList.add('show');
                isValid = false;
            } else {
                dateValidation.classList.remove('show');
            }
            
            return isValid;
        }
        
        // লেনদেন যোগ করুন - FIXED
        function addTransaction() {
            try {
                // ফর্ম ভ্যালিডেশন (ইতিমধ্যে হয়েছে)
                const customerName = document.getElementById('customerName').value.trim();
                let phone = document.getElementById('phone').value.trim();
                const serviceType = document.getElementById('serviceType').value;
                const amount = parseFloat(document.getElementById('amount').value);
                const paidAmount = parseFloat(document.getElementById('paidAmount').value) || 0;
                const transactionDate = document.getElementById('transactionDate').value;
                
                // ফোন নম্বর প্রসেসিং (8-11 ডিজিট)
                const numericPhone = phone.replace(/\s/g, '').replace(/\D/g, '');
                
                // ভ্যালিডেশন (আবার চেক)
                if (numericPhone.length < 8 || numericPhone.length > 11) {
                    showNotification('ফোন নম্বর ৮-১১ ডিজিটের মধ্যে হতে হবে!', 'error');
                    document.getElementById('phone').focus();
                    return;
                }
                
                // ফোন নম্বর ফরম্যাট করুন
                phone = '+961 ' + numericPhone;
                
                // নতুন কাস্টমার কনফার্মেশন (যদি পুরাতন নাম্বারে নতুন নাম হয়)
                const existingName = phoneToNameMap.get(phone);
                if (existingName && existingName !== customerName) {
                    const confirmChange = confirm(
                        `এই মোবাইল নম্বর (${phone}) এর পূর্বের কাস্টমার: "${existingName}"\n` +
                        `আপনি নতুন নাম দিচ্ছেন: "${customerName}"\n\n` +
                        `আপনি কি নিশ্চিত যে নাম পরিবর্তন করতে চান?`
                    );
                    
                    if (!confirmChange) {
                        document.getElementById('customerName').value = existingName;
                        showNotification('কাস্টমার নাম পূর্বের মতো রাখা হয়েছে', 'info');
                        return;
                    }
                }
                
                // বাকী টাকা ক্যালকুলেট
                const dueAmount = amount - paidAmount;
                
                // ফর্ম ডেটা সংগ্রহ
                const transaction = {
                    id: Date.now() + Math.floor(Math.random() * 1000),
                    date: transactionDate,
                    customerName: customerName,
                    serviceType: serviceType,
                    amount: amount,
                    paidAmount: paidAmount,
                    dueAmount: dueAmount >= 0 ? dueAmount : 0,
                    phone: phone,
                    notes: document.getElementById('notes').value.trim() || '',
                    status: dueAmount > 0 ? 'বাকী' : 'পরিশোধিত'
                };
                
                console.log("নতুন লেনদেন:", transaction);
                
                // লোকাল স্টোরেজে সেভ করুন
                saveTransaction(transaction);
                
                // কাস্টমার লিস্ট আপডেট
                loadAllCustomers();
                
                // যদি কারেন্ট কাস্টমার একই হয়, তাহলে আপডেট করুন
                if (currentCustomer && 
                    (currentCustomer.name === transaction.customerName || 
                     currentCustomer.phone === transaction.phone)) {
                    showCustomerDetails(currentCustomer.name, currentCustomer.phone);
                }
                
                // টেবিল আপডেট
                renderTable(currentFilter);
                
                // ড্যাশবোর্ড আপডেট
                updateDashboard();
                
                // চার্ট আপডেট
                renderCharts();
                
                // ফর্ম রিসেট (কিন্তু নাম্বার ফরম্যাট রাখুন)
                document.getElementById('customerName').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('serviceType').value = '';
                document.getElementById('amount').value = '';
                document.getElementById('paidAmount').value = '0';
                document.getElementById('dueAmount').value = '0';
                document.getElementById('transactionDate').valueAsDate = new Date();
                document.getElementById('notes').value = '';
                
                // ভ্যালিডেশন মেসেজ রিমুভ করুন
                document.querySelectorAll('.validation-message').forEach(msg => {
                    msg.classList.remove('show');
                });
                
                // অটো-কমপ্লিট বন্ধ করুন
                document.getElementById('nameAutocomplete').classList.remove('active');
                document.getElementById('phoneAutocomplete').classList.remove('active');
                
                // সফলতা বার্তা
                showNotification(`লেনদেন সফলভাবে যোগ হয়েছে! ${customerName} (${phone})`, 'success');
                
            } catch (error) {
                console.error("লেনদেন যোগ করার সময় সমস্যা:", error);
                showNotification('লেনদেন যোগ করতে সমস্যা হয়েছে!', 'error');
            }
        }
        
        // লোকাল স্টোরেজে ডেটা সেভ করুন
        function saveTransaction(transaction) {
            try {
                let transactions = JSON.parse(localStorage.getItem('telecomTransactions')) || [];
                transactions.push(transaction);
                localStorage.setItem('telecomTransactions', JSON.stringify(transactions));
                console.log("লেনদেন সেভ করা হয়েছে, মোট লেনদেন:", transactions.length);
            } catch (error) {
                console.error("ডেটা সেভ করতে সমস্যা:", error);
            }
        }
        
        // লোকাল স্টোরেজ থেকে ডেটা লোড করুন
        function loadData() {
            try {
                let transactions = JSON.parse(localStorage.getItem('telecomTransactions')) || [];
                
                // যদি ডেটা না থাকে, ডেমো ডেটা যোগ করুন (লেবানন ফোন নম্বর সহ)
                if (transactions.length === 0) {
                    const demoData = [
                        {
                            id: 1,
                            date: new Date().toISOString().split('T')[0],
                            customerName: 'আব্দুল করিম',
                            serviceType: 'ইন্টারনেট',
                            amount: 1200,
                            paidAmount: 1000,
                            dueAmount: 200,
                            phone: '+961 71 234 567',
                            notes: 'মাসিক প্যাকেজ',
                            status: 'বাকী'
                        },
                        {
                            id: 2,
                            date: new Date().toISOString().split('T')[0],
                            customerName: 'রহিমা বেগম',
                            serviceType: 'মোবাইল রিচার্জ',
                            amount: 500,
                            paidAmount: 500,
                            dueAmount: 0,
                            phone: '+961 81 928 374',
                            notes: '',
                            status: 'পরিশোধিত'
                        },
                        {
                            id: 3,
                            date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                            customerName: 'কামরুল হাসান',
                            serviceType: 'বিল পেমেন্ট',
                            amount: 850,
                            paidAmount: 500,
                            dueAmount: 350,
                            phone: '+961 76 074 708',
                            notes: 'বিদ্যুৎ বিল',
                            status: 'বাকী'
                        },
                        {
                            id: 4,
                            date: new Date(Date.now() - 2 * 86400000).toISOString().split('T')[0],
                            customerName: 'আব্দুল করিম',
                            serviceType: 'মোবাইল রিচার্জ',
                            amount: 300,
                            paidAmount: 200,
                            dueAmount: 100,
                            phone: '+961 71 234 567',
                            notes: '',
                            status: 'বাকী'
                        },
                        {
                            id: 5,
                            date: new Date(Date.now() - 5 * 86400000).toISOString().split('T')[0],
                            customerName: 'সালমা খাতুন',
                            serviceType: 'সিম কার্ড',
                            amount: 1500,
                            paidAmount: 1500,
                            dueAmount: 0,
                            phone: '+961 70 769 781',
                            notes: 'নতুন সিম',
                            status: 'পরিশোধিত'
                        }
                    ];
                    
                    transactions = demoData;
                    localStorage.setItem('telecomTransactions', JSON.stringify(transactions));
                    console.log("ডেমো ডেটা লোড করা হয়েছে (লেবানন ফোন নম্বর সহ)");
                }
                
                return transactions;
            } catch (error) {
                console.error("ডেটা লোড করতে সমস্যা:", error);
                return [];
            }
        }
        
        // কাস্টমার সার্চ ফাংশন
        function searchCustomer() {
            try {
                const searchTerm = document.getElementById('customerSearch').value.trim();
                
                if (!searchTerm) {
                    showNotification('কাস্টমারের নাম বা মোবাইল নম্বর লিখুন!', 'error');
                    return;
                }
                
                // সার্চ টার্ম দিয়ে কাস্টমার খুঁজুন
                let foundCustomer = null;
                
                for (const customer of allCustomers) {
                    if (customer.name.includes(searchTerm) || 
                        (customer.phone && customer.phone.includes(searchTerm))) {
                        foundCustomer = customer;
                        break;
                    }
                }
                
                if (foundCustomer) {
                    showCustomerDetails(foundCustomer.name, foundCustomer.phone);
                } else {
                    // নাম্বার শুধু নাম্বার হিসেবে সার্চ করুন
                    const numericSearch = searchTerm.replace(/\s/g, '').replace(/\D/g, '');
                    if (numericSearch.length >= 3) {
                        for (const customer of allCustomers) {
                            const customerNumericPhone = customer.phone.replace(/\s/g, '').replace(/\D/g, '');
                            if (customerNumericPhone.includes(numericSearch) || 
                                (numericSearch.includes(customerNumericPhone) && customerNumericPhone !== '')) {
                                foundCustomer = customer;
                                break;
                            }
                        }
                    }
                    
                    if (foundCustomer) {
                        showCustomerDetails(foundCustomer.name, foundCustomer.phone);
                    } else {
                        showNotification('কোন কাস্টমার পাওয়া যায়নি! নতুন কাস্টমার হলে প্রথমে লেনদেন যোগ করুন।', 'error');
                        document.getElementById('customerDetails').classList.remove('active');
                    }
                }
            } catch (error) {
                console.error("কাস্টমার সার্চে সমস্যা:", error);
                showNotification('কাস্টমার খোঁজার সময় সমস্যা হয়েছে!', 'error');
            }
        }
        
        // কাস্টমার ডিটেইলস দেখান
        function showCustomerDetails(name, phone) {
            try {
                const transactions = loadData();
                
                // এই কাস্টমারের সকল লেনদেন ফিল্টার করুন
                const customerTransactions = transactions.filter(t => 
                    t.customerName === name && t.phone === phone
                );
                
                if (customerTransactions.length === 0) {
                    showNotification('এই কাস্টমারের কোন লেনদেন নেই!', 'error');
                    return;
                }
                
                // কাস্টমার তথ্য সংগ্রহ
                const totalPaid = customerTransactions.reduce((sum, t) => sum + (parseFloat(t.paidAmount) || 0), 0);
                const totalDue = customerTransactions.reduce((sum, t) => sum + (parseFloat(t.dueAmount) || 0), 0);
                const totalAmount = customerTransactions.reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);
                
                // সর্বশেষ লেনদেন তারিখ
                const sortedTransactions = [...customerTransactions].sort((a, b) => 
                    new Date(b.date) - new Date(a.date));
                const lastTransaction = sortedTransactions[0];
                
                // কাস্টমার অ্যাভাটার প্রথম অক্ষর
                const firstLetter = name && name.length > 0 ? name.charAt(0).toUpperCase() : '?';
                
                // ডিটেইলস কার্ড আপডেট
                document.getElementById('customerAvatar').textContent = firstLetter;
                document.getElementById('customerNameDisplay').textContent = name;
                document.getElementById('customerPhoneDisplay').textContent = `মোবাইল: ${phone}`;
                document.getElementById('customerTotalDue').textContent = `৳ ${totalDue.toLocaleString('bn-BD')}`;
                document.getElementById('customerTotalPaid').textContent = `৳ ${totalPaid.toLocaleString('bn-BD')}`;
                document.getElementById('customerTotalTransactions').textContent = `${customerTransactions.length} বার`;
                document.getElementById('customerLastTransaction').textContent = 
                    lastTransaction ? formatDate(lastTransaction.date) : 'তারিখ নেই';
                
                // সাম্প্রতিক লেনদেন দেখান (শেষ ৫টি)
                const recentTransactions = sortedTransactions.slice(0, 5);
                
                const recentHtml = recentTransactions.map(t => `
                    <div style="
                        background: white; 
                        padding: 12px 15px; 
                        margin-bottom: 10px; 
                        border-radius: 8px;
                        border-left: 4px solid ${t.dueAmount > 0 ? '#f39c12' : '#27ae60'};
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    ">
                        <div>
                            <div style="font-weight: bold;">${formatDate(t.date)} - ${t.serviceType}</div>
                            <div style="font-size: 0.9rem; color: #666;">মোট: ৳${t.amount}, নগদ: ৳${t.paidAmount}, বাকী: ৳${t.dueAmount}</div>
                        </div>
                        <span class="status-${t.dueAmount > 0 ? 'due' : 'paid'}" style="font-size: 0.8rem;">
                            ${t.status}
                        </span>
                    </div>
                `).join('');
                
                document.getElementById('recentTransactions').innerHTML = recentHtml || 
                    '<p style="text-align: center; color: #666; padding: 20px;">কোন লেনদেন নেই</p>';
                
                // কারেন্ট কাস্টমার সেট করুন
                currentCustomer = { name, phone };
                
                // ফর্মে কাস্টমার তথ্য সেট করুন
                document.getElementById('customerName').value = name;
                // ফোন নম্বর শুধু নাম্বার অংশ সেট করুন
                const phoneNumberOnly = phone.replace('+961 ', '').replace(/\s/g, '');
                document.getElementById('phone').value = phoneNumberOnly;
                
                // ডিটেইলস কার্ড দেখান
                document.getElementById('customerDetails').classList.add('active');
                
                // সফলতা বার্তা
                showNotification('কাস্টমার পাওয়া গেছে! ফর্মে তথ্য অটোফিল হয়েছে।', 'success');
                
            } catch (error) {
                console.error("কাস্টমার ডিটেইলস দেখাতে সমস্যা:", error);
                showNotification('কাস্টমার তথ্য দেখাতে সমস্যা হয়েছে!', 'error');
            }
        }
        
        // কাস্টমারের সকল লেনদেন টেবিলে দেখান
        function showAllTransactions() {
            if (!currentCustomer) return;
            
            // ফিল্টার বাটন আপডেট করুন
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            
            // বিশেষ ফিল্টার প্রয়োগ করুন
            filterData('customer');
            
            // কাস্টমার সার্চ বক্সে স্ক্রোল করুন
            document.getElementById('customerSearch').scrollIntoView({ behavior: 'smooth' });
            
            showNotification(`${currentCustomer.name} এর সকল লেনদেন দেখানো হচ্ছে`, 'success');
        }
        
        // টেবিল রেন্ডার
        function renderTable(filter = 'all') {
            try {
                currentFilter = filter;
                let transactions = loadData();
                const tbody = document.getElementById('transactionsBody');
                tbody.innerHTML = '';
                
                // ফিল্টার প্রয়োগ
                const now = new Date();
                let filteredTransactions = transactions;
                
                if (filter === 'today') {
                    const today = now.toISOString().split('T')[0];
                    filteredTransactions = transactions.filter(t => t.date === today);
                } else if (filter === 'week') {
                    const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredTransactions = transactions.filter(t => new Date(t.date) >= oneWeekAgo);
                } else if (filter === 'month') {
                    const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                    filteredTransactions = transactions.filter(t => new Date(t.date) >= oneMonthAgo);
                } else if (filter === 'customer' && currentCustomer) {
                    // শুধু কারেন্ট কাস্টমারের লেনদেন
                    filteredTransactions = transactions.filter(t => 
                        t.customerName === currentCustomer.name && 
                        t.phone === currentCustomer.phone
                    );
                }
                
                // তারিখ অনুসারে সাজানো (নতুন থেকে পুরাতন)
                filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // টেবিলে দেখানো
                if (filteredTransactions.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 30px; color: #666;">
                                <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                কোন লেনদেন পাওয়া যায়নি
                            </td>
                        </tr>
                    `;
                } else {
                    filteredTransactions.forEach(transaction => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${formatDate(transaction.date)}</td>
                            <td>${transaction.customerName}</td>
                            <td>${transaction.serviceType}</td>
                            <td>৳ ${transaction.amount}</td>
                            <td>৳ ${transaction.paidAmount}</td>
                            <td>৳ ${transaction.dueAmount}</td>
                            <td><span class="status-${transaction.dueAmount > 0 ? 'due' : 'paid'}">${transaction.status}</span></td>
                            <td>${transaction.phone}</td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editTransaction(${transaction.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteTransaction(${transaction.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                
                // যদি কারেন্ট কাস্টমার ফিল্টার প্রয়োগ করা হয়
                if (filter === 'customer' && currentCustomer) {
                    const tableHeading = document.querySelector('.data-table-container h2');
                    tableHeading.innerHTML = `<i class="fas fa-list"></i> ${currentCustomer.name} - সকল লেনদেন (${filteredTransactions.length}টি)`;
                } else {
                    const tableHeading = document.querySelector('.data-table-container h2');
                    tableHeading.innerHTML = `<i class="fas fa-list"></i> সকল লেনদেনের তালিকা (${filteredTransactions.length}টি)`;
                }
                
            } catch (error) {
                console.error("টেবিল রেন্ডারে সমস্যা:", error);
                showNotification('টেবিল লোড করতে সমস্যা হয়েছে!', 'error');
            }
        }
        
        // তারিখ ফরম্যাট করুন
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('bn-BD');
            } catch (error) {
                return dateString;
            }
        }
        
        // ড্যাশবোর্ড আপডেট
        function updateDashboard() {
            try {
                const transactions = loadData();
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                
                // আজকের ডেটা
                const todayTransactions = transactions.filter(t => t.date === today);
                const todayCash = todayTransactions.reduce((sum, t) => sum + (parseFloat(t.paidAmount) || 0), 0);
                const todayDue = todayTransactions.reduce((sum, t) => sum + (parseFloat(t.dueAmount) || 0), 0);
                const todaySales = todayTransactions.reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);
                
                // গতকালের ডেটা
                const yesterday = new Date(now.getTime() - 86400000).toISOString().split('T')[0];
                const yesterdayTransactions = transactions.filter(t => t.date === yesterday);
                const yesterdayCash = yesterdayTransactions.reduce((sum, t) => sum + (parseFloat(t.paidAmount) || 0), 0);
                
                // এই সপ্তাহের ডেটা
                const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                const weekTransactions = transactions.filter(t => new Date(t.date) >= oneWeekAgo);
                const weekSales = weekTransactions.reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);
                
                // এই মাসের ডেটা
                const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                const monthTransactions = transactions.filter(t => new Date(t.date) >= oneMonthAgo);
                const monthSales = monthTransactions.reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);
                
                // মোট ডেটা
                const totalDue = transactions.reduce((sum, t) => sum + (parseFloat(t.dueAmount) || 0), 0);
                const totalSales = transactions.reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);
                const totalCash = transactions.reduce((sum, t) => sum + (parseFloat(t.paidAmount) || 0), 0);
                const totalCustomers = new Set(transactions.map(t => `${t.customerName}|${t.phone || 'নাই'}`)).size;
                
                // ড্যাশবোর্ড আপডেট
                document.getElementById('todayCash').textContent = todayCash.toLocaleString('bn-BD');
                document.getElementById('totalDue').textContent = totalDue.toLocaleString('bn-BD');
                document.getElementById('totalSales').textContent = totalSales.toLocaleString('bn-BD');
                document.getElementById('totalCustomers').textContent = totalCustomers.toLocaleString('bn-BD');
                
                // পরিবর্তন দেখানো
                const cashChange = yesterdayCash > 0 ? ((todayCash - yesterdayCash) / yesterdayCash * 100).toFixed(1) : 0;
                document.getElementById('todayCashChange').innerHTML = cashChange > 0 ? 
                    `<span style="color: green;">↑ ${cashChange}% গতকাল থেকে</span>` : 
                    `<span style="color: red;">↓ ${Math.abs(cashChange)}% গতকাল থেকে</span>`;
                    
                document.getElementById('totalSalesChange').textContent = `সপ্তাহ: ৳${weekSales.toLocaleString('bn-BD')} | মাস: ৳${monthSales.toLocaleString('bn-BD')}`;
                document.getElementById('totalDueChange').textContent = `আজকের বাকী: ৳${todayDue.toLocaleString('bn-BD')}`;
                document.getElementById('customerChange').textContent = `আজকের কাস্টমার: ${todayTransactions.length}`;
                
            } catch (error) {
                console.error("ড্যাশবোর্ড আপডেটে সমস্যা:", error);
            }
        }
        
        // চার্ট রেন্ডার
        function renderCharts() {
            try {
                const transactions = loadData();
                
                // নগদ vs বাকী চার্ট
                const totalCash = transactions.reduce((sum, t) => sum + (parseFloat(t.paidAmount) || 0), 0);
                const totalDue = transactions.reduce((sum, t) => sum + (parseFloat(t.dueAmount) || 0), 0);
                
                const cashVsDueCtx = document.getElementById('cashVsDueChart').getContext('2d');
                if (window.cashVsDueChart) window.cashVsDueChart.destroy();
                
                window.cashVsDueChart = new Chart(cashVsDueCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['নগদ', 'বাকী'],
                        datasets: [{
                            data: [totalCash, totalDue],
                            backgroundColor: ['#27ae60', '#f39c12'],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ৳${context.raw.toLocaleString('bn-BD')}`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                // সাপ্তাহিক বিক্রি চার্ট
                const now = new Date();
                const weekDays = ['রবি', 'সোম', 'মঙ্গল', 'বুধ', 'বৃহঃ', 'শুক্র', 'শনি'];
                const weekSalesData = [0, 0, 0, 0, 0, 0, 0];
                
                // গত ৭ দিনের ডেটা সংগ্রহ
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now.getTime() - i * 86400000);
                    const dateStr = date.toISOString().split('T')[0];
                    const daySales = transactions
                        .filter(t => t.date === dateStr)
                        .reduce((sum, t) => sum + (parseFloat(t.amount) || 0), 0);
                    
                    weekSalesData[6 - i] = daySales;
                }
                
                const weeklySalesCtx = document.getElementById('weeklySalesChart').getContext('2d');
                if (window.weeklySalesChart) window.weeklySalesChart.destroy();
                
                window.weeklySalesChart = new Chart(weeklySalesCtx, {
                    type: 'bar',
                    data: {
                        labels: weekDays,
                        datasets: [{
                            label: 'বিক্রি (৳)',
                            data: weekSalesData,
                            backgroundColor: '#3498db',
                            borderColor: '#2980b9',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '৳' + value.toLocaleString('bn-BD');
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `বিক্রি: ৳${context.raw.toLocaleString('bn-BD')}`;
                                    }
                                }
                            }
                        }
                    }
                });
                
            } catch (error) {
                console.error("চার্ট রেন্ডারে সমস্যা:", error);
            }
        }
        
        // ডেটা ফিল্টার
        function filterData(timeFrame) {
            try {
                // বাটন সক্রিয় করুন (শুধুমাত্র স্ট্যান্ডার্ড ফিল্টারের জন্য)
                if (timeFrame !== 'customer') {
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    event.target.classList.add('active');
                }
                
                // টেবিল ফিল্টার করুন
                renderTable(timeFrame);
                
                // ড্যাশবোর্ড আপডেট
                updateDashboard();
                
            } catch (error) {
                console.error("ডেটা ফিল্টারে সমস্যা:", error);
            }
        }
        
        // নোটিফিকেশন দেখান
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // ৩ সেকেন্ড পর নোটিফিকেশন মুছে ফেলুন
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // লেনদেন এডিট
        function editTransaction(id) {
            showNotification('এডিট ফিচারটি শীঘ্রই যোগ করা হবে!', 'info');
        }
        
        // লেনদেন ডিলিট
        function deleteTransaction(id) {
            if (confirm('আপনি কি নিশ্চিত এই লেনদেনটি মুছে ফেলতে চান?')) {
                try {
                    let transactions = loadData();
                    const transactionToDelete = transactions.find(t => t.id === id);
                    transactions = transactions.filter(t => t.id !== id);
                    localStorage.setItem('telecomTransactions', JSON.stringify(transactions));
                    
                    // কাস্টমার লিস্ট আপডেট
                    loadAllCustomers();
                    
                    // যদি কারেন্ট কাস্টমারের লেনদেন হয়, তাহলে আপডেট করুন
                    if (currentCustomer && transactionToDelete && 
                        (transactionToDelete.customerName === currentCustomer.name && 
                         transactionToDelete.phone === currentCustomer.phone)) {
                        showCustomerDetails(currentCustomer.name, currentCustomer.phone);
                    }
                    
                    renderTable(currentFilter);
                    updateDashboard();
                    renderCharts();
                    
                    showNotification('লেনদেন মুছে ফেলা হয়েছে!', 'success');
                } catch (error) {
                    console.error("লেনদেন ডিলিটে সমস্যা:", error);
                    showNotification('লেনদেন মুছে ফেলতে সমস্যা হয়েছে!', 'error');
                }
            }
        }
    </script>
</body>
</html>